<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz App</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#a18cd1,#fbc2eb,#8fd3f4);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.container{
  width:90%;
  max-width:800px;
  background:white;
  border-radius:20px;
  padding:20px;
  box-shadow:0 8px 20px rgba(0,0,0,0.2);
}

h1,h2{text-align:center}
.hidden{display:none}

.set{
  display:flex;
  align-items:center;
  background:#f3f3f3;
  border-radius:15px;
  padding:10px;
  margin:10px 0;
  cursor:pointer;
}
.set:hover{background:#e8e8e8}

.set img{
  width:60px;
  height:60px;
  border-radius:12px;
  margin-right:15px;
  object-fit:cover;
}

.set-buttons{
  margin-left:auto;
  display:flex;
  gap:5px;
}

.answer{
  padding:15px;
  margin:10px 0;
  border:none;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
  width:100%;
}

.a1{background:#4facfe;color:white}
.a2{background:#43e97b;color:white}
.a3{background:#fa709a;color:white}
.a4{background:#667eea;color:white}

.correct{outline:4px solid #2ecc71}
.incorrect{outline:4px solid #e74c3c}
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<div id="home">
<h1>Mes Quiz</h1>
<button onclick="newQuiz()">‚ûï Nouveau quiz</button>
<button onclick="document.getElementById('import').click()">üì• Importer un quiz</button>
<button onclick="exportAll()">üíæ Exporter tous les quiz</button>
<input type="file" id="import" class="hidden" onchange="importQuiz(event)">
<div id="list"></div>
</div>

<!-- EDITOR -->
<div id="editor" class="hidden">
<h2>Cr√©er / Modifier un quiz</h2>

<input id="title" placeholder="Titre du quiz"><br><br>

<input id="image" placeholder="URL image du quiz"><br>
<input type="file" id="imageFile" accept="image/*" class="hidden">
<button onclick="document.getElementById('imageFile').click()">üì∏ Galerie couverture</button>
<br><br>

<div id="questions"></div>
<button onclick="addQuestion()">‚ûï Ajouter une question</button><br><br>

<button onclick="saveQuiz()">üíæ Sauvegarder</button>
<button onclick="home()">üè† Accueil</button>
</div>

<!-- GAME -->
<div id="game" class="hidden">
<h2 id="qTitle"></h2>
<p id="question"></p>
<div id="answers"></div>
</div>

<!-- SCORE -->
<div id="score" class="hidden">
<h2>R√©sultat</h2>
<p id="result"></p>
<button onclick="home()">üè† Accueil</button>
</div>

</div>

<script>
let quizzes = JSON.parse(localStorage.getItem("quizzes")) || [];
let currentQuizIndex = null;
let qi = 0;
let score = 0;

function save(){ localStorage.setItem("quizzes",JSON.stringify(quizzes)); }

document.getElementById("imageFile").onchange = e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ev=>{
    document.getElementById("image").value = ev.target.result;
  };
  reader.readAsDataURL(file);
};

function hideAll(){
  document.querySelectorAll(".container>div").forEach(d=>d.classList.add("hidden"));
}

function home(){
  hideAll();
  document.getElementById("home").classList.remove("hidden");
  render();
}

function render(){
  const l=document.getElementById("list");
  l.innerHTML="";
  quizzes.forEach((q,i)=>{
    const d=document.createElement("div");
    d.className="set";
    d.innerHTML=`
      <img src="${q.image || 'https://via.placeholder.com/60'}">
      <div><b>${q.title}</b></div>
    `;
    d.onclick=()=>start(i);

    const b=document.createElement("div");
    b.className="set-buttons";

    const edit=document.createElement("button");
    edit.textContent="‚úèÔ∏è Modifier";
    edit.onclick=e=>{e.stopPropagation();editQuiz(i);};

    const share=document.createElement("button");
    share.textContent="üì§ Partager";
    share.onclick=e=>{e.stopPropagation();shareQuiz(i);};

    const del=document.createElement("button");
    del.textContent="üóëÔ∏è";
    del.onclick=e=>{
      e.stopPropagation();
      if(confirm("Supprimer ce quiz ?")){
        quizzes.splice(i,1);
        save();render();
      }
    };

    b.append(edit,share,del);
    d.appendChild(b);
    l.appendChild(d);
  });
}

function newQuiz(){
  currentQuizIndex=null;
  document.getElementById("title").value="";
  document.getElementById("image").value="";
  document.getElementById("questions").innerHTML="";
  hideAll();
  document.getElementById("editor").classList.remove("hidden");
}

function editQuiz(i){
  currentQuizIndex=i;
  const q=quizzes[i];
  document.getElementById("title").value=q.title;
  document.getElementById("image").value=q.image||"";
  document.getElementById("questions").innerHTML="";
  q.questions.forEach(x=>addQuestion(x.q,x.a,x.c));
  hideAll();
  document.getElementById("editor").classList.remove("hidden");
}

function addQuestion(q="",a=["","","",""],c=0){
  const d=document.createElement("div");
  d.innerHTML=`
    <input placeholder="Question" value="${q}"><br>
    ${a.map((x,i)=>`<input placeholder="R√©ponse ${i+1}" value="${x}"><br>`).join("")}
    <input type="number" min="1" max="4" value="${c+1}"> Bonne r√©ponse
    <hr>
  `;
  document.getElementById("questions").appendChild(d);
}

function saveQuiz(){
  const title=document.getElementById("title").value;
  const image=document.getElementById("image").value;
  const qs=[];
  document.querySelectorAll("#questions>div").forEach(d=>{
    const i=d.querySelectorAll("input");
    qs.push({
      q:i[0].value,
      a:[i[1].value,i[2].value,i[3].value,i[4].value],
      c:parseInt(i[5].value)-1
    });
  });
  const quiz={title,image,questions:qs};
  if(currentQuizIndex!==null) quizzes[currentQuizIndex]=quiz;
  else quizzes.push(quiz);
  save();
  home();
}

function start(i){
  currentQuizIndex=i;
  qi=0;score=0;
  hideAll();
  document.getElementById("game").classList.remove("hidden");
  document.getElementById("qTitle").textContent=quizzes[i].title;
  showQ();
}

function showQ(){
  const q=quizzes[currentQuizIndex].questions[qi];
  document.getElementById("question").textContent=q.q;
  const a=document.getElementById("answers");
  a.innerHTML="";
  q.a.forEach((t,i)=>{
    const b=document.createElement("button");
    b.className="answer a"+(i+1);
    b.textContent=t;
    b.onclick=()=>{
      if(i===q.c){score++;b.classList.add("correct");}
      else b.classList.add("incorrect");
      setTimeout(next,600);
    };
    a.appendChild(b);
  });
}

function next(){
  qi++;
  if(qi<quizzes[currentQuizIndex].questions.length) showQ();
  else{
    hideAll();
    document.getElementById("score").classList.remove("hidden");
    document.getElementById("result").textContent=
      `Score : ${score} / ${quizzes[currentQuizIndex].questions.length}`;
  }
}

function shareQuiz(i){
  const blob=new Blob([JSON.stringify(quizzes[i],null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=(quizzes[i].title||"quiz")+".json";
  a.click();
}

function importQuiz(e){
  const r=new FileReader();
  r.onload=x=>{
    quizzes.push(JSON.parse(x.target.result));
    save();render();
  };
  r.readAsText(e.target.files[0]);
}

function exportAll(){
  const blob=new Blob([JSON.stringify(quizzes,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="quizzes.json";
  a.click();
}

home();
</script>
</body>
</html>
