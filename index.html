<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz App</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#a18cd1,#fbc2eb,#8fd3f4);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.container{
  width:90%;
  max-width:800px;
  background:white;
  border-radius:20px;
  padding:20px;
  box-shadow:0 8px 20px rgba(0,0,0,0.2);
}

.hidden{ display:none; }

h1,h2{ text-align:center; }

button{
  padding:4px 8px;
  font-size:14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.set{
  display:flex;
  align-items:center;
  background:#f3f3f3;
  border-radius:15px;
  padding:10px;
  margin:10px 0;
  cursor:pointer;
}

.set img{
  width:60px;
  height:60px;
  object-fit:cover;
  border-radius:12px;
  margin-right:15px;
}

.set-buttons{
  margin-left:auto;
  display:flex;
  gap:5px;
}

.card-container{
  perspective:1000px;
}

.card{
  width:100%;
  height:380px;
  position:relative;
  transform-style:preserve-3d;
  transition:transform .6s;
  cursor:pointer;
}

.card.flipped{ transform:rotateY(180deg); }

.card-face{
  position:absolute;
  width:100%;
  height:100%;
  backface-visibility:hidden;
  border-radius:20px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  padding:20px;
  box-sizing:border-box;
}

.card-back{
  transform:rotateY(180deg);
  background:#f0f0f0;
}

.card-face img{
  width:100%;
  max-height:250px;
  object-fit:contain;
  margin-bottom:15px;
}

.answer-buttons{
  display:flex;
  justify-content:space-between;
  margin-top:15px;
}

.answer-buttons button{
  flex:1;
  margin:0 5px;
  padding:10px;
}

.correct{ background:#a0e7a0; }
.incorrect{ background:#f28b82; }
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<div id="home-screen">
<h1>Mes Quiz</h1>
<button onclick="showEditor()">‚ûï Nouveau quiz</button>
<div id="quiz-list"></div>
</div>

<!-- EDITOR -->
<div id="editor-screen" class="hidden">
<h2>Cr√©er / Modifier un Quiz</h2>
<input id="quiz-title" placeholder="Titre"><br><br>
<div id="questions-editor"></div>
<button onclick="addQuestion()">‚ûï Ajouter une question</button><br><br>
<button onclick="saveQuiz()">üíæ Sauvegarder</button>
<button onclick="goHome()">üè† Accueil</button>
</div>

<!-- GAME -->
<div id="game-screen" class="hidden">
<h2 id="game-title"></h2>
<div class="card-container" id="game-card"></div>
<div class="answer-buttons">
<button class="incorrect" onclick="markAnswer(false)">Mauvais</button>
<button class="correct" onclick="markAnswer(true)">Bon</button>
</div>
</div>

<!-- SCORE -->
<div id="score-screen" class="hidden">
<h2>R√©sultat</h2>
<p id="final-score"></p>
<button onclick="restartAll()">üîÑ Recommencer tout</button>
<button onclick="restartErrors()">‚ùå Rejouer erreurs</button>
<button onclick="goHome()">üè† Accueil</button>
</div>

</div>

<script>
let quizzes = JSON.parse(localStorage.getItem("quizzes")) || [];
let currentQuiz = null;
let activeCards = [];
let currentIndex = 0;
let errors = [];
let goodAnswers = 0;

function save(){ localStorage.setItem("quizzes",JSON.stringify(quizzes)); }

function goHome(){
  document.querySelectorAll(".container > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById("home-screen").classList.remove("hidden");
  displayQuizzes();
}

function displayQuizzes(){
  const list=document.getElementById("quiz-list");
  list.innerHTML="";
  quizzes.forEach((q,i)=>{
    const div=document.createElement("div");
    div.className="set";
    div.innerHTML=`<strong>${q.title}</strong>`;
    div.onclick=()=>startGame(i);

    const btns=document.createElement("div");
    btns.className="set-buttons";

    const edit=document.createElement("button");
    edit.textContent="‚úèÔ∏è";
    edit.onclick=e=>{e.stopPropagation(); showEditor(i);};

    const del=document.createElement("button");
    del.textContent="üóëÔ∏è";
    del.onclick=e=>{
      e.stopPropagation();
      quizzes.splice(i,1);
      save();
      displayQuizzes();
    };

    btns.append(edit,del);
    div.appendChild(btns);
    list.appendChild(div);
  });
}

function showEditor(i=null){
  document.querySelectorAll(".container > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById("editor-screen").classList.remove("hidden");
  document.getElementById("questions-editor").innerHTML="";
  if(i!==null){
    currentQuiz=quizzes[i];
    document.getElementById("quiz-title").value=currentQuiz.title;
    currentQuiz.questions.forEach(q=>addQuestion(q));
  }else{
    currentQuiz=null;
    document.getElementById("quiz-title").value="";
    addQuestion();
  }
}

function addQuestion(q={text:"",answer:"",image:""}){
  const div=document.createElement("div");
  div.innerHTML=`
    <input placeholder="Question" value="${q.text}"><br>
    <input placeholder="R√©ponse" value="${q.answer}"><br>
    <input placeholder="URL image (optionnel)" value="${q.image}"><hr>
  `;
  document.getElementById("questions-editor").appendChild(div);
}

function saveQuiz(){
  const title=document.getElementById("quiz-title").value;
  const questions=[];
  document.querySelectorAll("#questions-editor > div").forEach(d=>{
    const i=d.querySelectorAll("input");
    if(i[0].value && i[1].value)
      questions.push({text:i[0].value,answer:i[1].value,image:i[2].value});
  });
  if(currentQuiz){
    currentQuiz.title=title;
    currentQuiz.questions=questions;
  }else{
    quizzes.push({title,questions});
  }
  save();
  goHome();
}

function startGame(i){
  currentQuiz=quizzes[i];
  activeCards=[...currentQuiz.questions];
  currentIndex=0;
  errors=[];
  goodAnswers=0;
  document.querySelectorAll(".container > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById("game-screen").classList.remove("hidden");
  document.getElementById("game-title").textContent=currentQuiz.title;
  showCard();
}

function showCard(){
  const c=activeCards[currentIndex];
  const box=document.getElementById("game-card");
  box.innerHTML=`
  <div class="card" onclick="this.classList.toggle('flipped')">
    <div class="card-face">
      ${c.image?`<img src="${c.image}">`:""}
      <div>${c.text}</div>
    </div>
    <div class="card-face card-back">
      ${c.image?`<img src="${c.image}">`:""}
      <div>${c.answer}</div>
    </div>
  </div>`;
}

function markAnswer(ok){
  if(ok) goodAnswers++;
  else errors.push(activeCards[currentIndex]);
  currentIndex++;
  if(currentIndex<activeCards.length) showCard();
  else endGame();
}

function endGame(){
  document.querySelectorAll(".container > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById("score-screen").classList.remove("hidden");
  document.getElementById("final-score").textContent=
    `Score : ${goodAnswers} / ${activeCards.length}`;
}

function restartAll(){
  startGame(quizzes.indexOf(currentQuiz));
}

function restartErrors(){
  if(errors.length===0){ alert("Aucune erreur"); return; }
  activeCards=[...errors];
  currentIndex=0;
  errors=[];
  goodAnswers=0;
  document.querySelectorAll(".container > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById("game-screen").classList.remove("hidden");
  showCard();
}

goHome();
</script>
</body>
</html>
