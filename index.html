<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz App</title>
<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#a18cd1,#fbc2eb,#8fd3f4);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container{
  width:90%;
  max-width:800px;
  background:white;
  border-radius:20px;
  padding:20px;
  box-shadow:0 8px 20px rgba(0,0,0,0.2);
}
h1,h2{text-align:center}
.hidden{display:none}
.set{
  display:flex;
  align-items:center;
  background:#f3f3f3;
  border-radius:15px;
  padding:10px;
  margin:10px 0;
  cursor:pointer;
}
.set:hover{background:#e8e8e8}
.set img{
  width:60px;
  height:60px;
  border-radius:12px;
  margin-right:15px;
  object-fit:cover;
}
.set-buttons{
  margin-left:auto;
  display:flex;
  gap:5px;
}
.answer-row{
  display:flex;
  justify-content:space-between;
  margin:5px 0;
}
.answer{
  flex: 0 0 48%;
  padding:15px;
  margin:0;
  border:none;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
}
.correct{outline:4px solid #2ecc71}
.incorrect{outline:4px solid #e74c3c}
.quiz-img{width:100%;max-height:250px;object-fit:cover;margin-bottom:15px;border-radius:12px;}
.question-editor input{margin:2px 0;}
</style>
</head>
<body>
<div class="container">

<!-- HOME -->
<div id="home">
<h1>Mes Quiz</h1>
<button onclick="newQuiz()">‚ûï Nouveau quiz</button>
<button onclick="document.getElementById('import').click()">üì• Importer un quiz</button>
<button onclick="exportAll()">üíæ Exporter tous les quiz</button>
<input type="file" id="import" class="hidden" onchange="importQuiz(event)">
<div id="list"></div>
</div>

<!-- EDITOR -->
<div id="editor" class="hidden">
<h2>Cr√©er / Modifier un quiz</h2>
<input id="title" placeholder="Titre du quiz"><br><br>
<input id="image" placeholder="URL image du quiz"><br>
<input type="file" id="imageFile" accept="image/*" class="hidden">
<button onclick="document.getElementById('imageFile').click()">üì∏ Galerie couverture</button>
<br><br>

<div id="questions"></div>
<button onclick="addQuestion()">‚ûï Ajouter une question</button><br><br>

<button onclick="saveQuiz()">üíæ Sauvegarder</button>
<button onclick="home()">üè† Accueil</button>
</div>

<!-- GAME -->
<div id="game" class="hidden">
<h2 id="qTitle"></h2>
<div id="quiz-img-container"></div>
<p id="question"></p>
<div id="answers"></div>
</div>

<!-- SCORE -->
<div id="score" class="hidden">
<h2>R√©sultat</h2>
<p id="result"></p>
<button onclick="home()">üè† Accueil</button>
</div>

</div>

<script>
let quizzes = JSON.parse(localStorage.getItem("quizzes")) || [];
let currentQuizIndex = null;
let qi = 0;
let score = 0;
let currentAnswers = [];

document.getElementById("imageFile").onchange = e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ev=>{
    document.getElementById("image").value = ev.target.result;
  };
  reader.readAsDataURL(file);
};

function save(){ localStorage.setItem("quizzes",JSON.stringify(quizzes)); }

function hideAll(){ document.querySelectorAll(".container>div").forEach(d=>d.classList.add("hidden")); }

function home(){
  hideAll();
  document.getElementById("home").classList.remove("hidden");
  render();
}

function render(){
  const l=document.getElementById("list");
  l.innerHTML="";
  quizzes.forEach((q,i)=>{
    const d=document.createElement("div");
    d.className="set";
    d.innerHTML=`
      <img src="${q.image || 'https://via.placeholder.com/60'}">
      <div><b>${q.title}</b></div>
    `;
    d.onclick=()=>start(i);

    const b=document.createElement("div");
    b.className="set-buttons";

    const edit=document.createElement("button");
    edit.textContent="‚úèÔ∏è Modifier";
    edit.onclick=e=>{e.stopPropagation();editQuiz(i);};

    const share=document.createElement("button");
    share.textContent="üì§ Partager";
    share.onclick=e=>{e.stopPropagation();shareQuiz(i);};

    const del=document.createElement("button");
    del.textContent="üóëÔ∏è";
    del.onclick=e=>{
      e.stopPropagation();
      if(confirm("Supprimer ce quiz ?")){
        quizzes.splice(i,1);
        save();render();
      }
    };

    b.append(edit,share,del);
    d.appendChild(b);
    l.appendChild(d);
  });
}

function newQuiz(){
  currentQuizIndex=null;
  document.getElementById("title").value="";
  document.getElementById("image").value="";
  document.getElementById("questions").innerHTML="";
  hideAll();
  document.getElementById("editor").classList.remove("hidden");
}

function editQuiz(i){
  currentQuizIndex=i;
  const q=quizzes[i];
  document.getElementById("title").value=q.title;
  document.getElementById("image").value=q.image||"";
  document.getElementById("questions").innerHTML="";
  q.questions.forEach(x=>addQuestion(x.q,x.a,x.c,x.img));
  hideAll();
  document.getElementById("editor").classList.remove("hidden");
}

// √âditeur de question avec URL image derni√®re ligne + bouton üì∏
function addQuestion(q="",a=["","","",""],c=0,img=""){
  const d=document.createElement("div");
  d.className="question-editor";
  d.style.marginBottom="15px";

  d.innerHTML=`
    <input placeholder="Question" value="${q}"><br>
    ${a.map((x,i)=>`<input placeholder="R√©ponse ${i+1}" value="${x}"><br>`).join("")}
    <input type="number" min="1" max="4" value="${c+1}"> Bonne r√©ponse<br>
    <div style="display:flex; align-items:center; margin-top:5px;">
      <input placeholder="URL image (optionnel)" value="${img}" style="flex:1">
      <button style="margin-left:5px;">üì∏</button>
    </div>
    <hr>
  `;

  document.getElementById("questions").appendChild(d);

  const imgInput = d.querySelector("input[placeholder='URL image (optionnel)']");
  const photoBtn = d.querySelector("button");

  const fileInput = document.createElement("input");
  fileInput.type="file";
  fileInput.accept="image/*";
  fileInput.style.display="none";
  d.appendChild(fileInput);

  photoBtn.onclick = ()=> fileInput.click();

  fileInput.onchange = (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = ev=>{ imgInput.value = ev.target.result; };
    reader.readAsDataURL(file);
  };
}

function saveQuiz(){
  const title=document.getElementById("title").value;
  const image=document.getElementById("image").value;
  const qs=[];
  document.querySelectorAll("#questions>div").forEach(d=>{
    const i=d.querySelectorAll("input");
    qs.push({
      q:i[0].value,
      a:[i[1].value,i[2].value,i[3].value,i[4].value],
      c:parseInt(i[5].value)-1,
      img:i[6].value
    });
  });
  const quiz={title,image,questions:qs};
  if(currentQuizIndex!==null) quizzes[currentQuizIndex]=quiz;
  else quizzes.push(quiz);
  save();
  home();
}

function start(i){
  currentQuizIndex=i;
  qi=0;score=0;
  hideAll();
  document.getElementById("game").classList.remove("hidden");
  document.getElementById("qTitle").textContent=quizzes[i].title;
  showQ();
}

function showQ(){
  const q=quizzes[currentQuizIndex].questions[qi];
  const imgContainer=document.getElementById("quiz-img-container");
  imgContainer.innerHTML="";
  if(q.img){
    const img=document.createElement("img");
    img.src=q.img;
    img.className="quiz-img";
    imgContainer.appendChild(img);
  }

  document.getElementById("question").textContent=q.q;

  currentAnswers=q.a.map((text,index)=>({text,index}));
  for(let j=currentAnswers.length-1;j>0;j--){
    const k=Math.floor(Math.random()*(j+1));
    [currentAnswers[j],currentAnswers[k]]=[currentAnswers[k],currentAnswers[j]];
  }

  const aDiv=document.getElementById("answers");
  aDiv.innerHTML="";
  for(let row=0;row<2;row++){
    const rowDiv=document.createElement("div");
    rowDiv.className="answer-row";
    for(let col=0;col<2;col++){
      const ansObj=currentAnswers[row*2+col];
      if(!ansObj) continue;
      const b=document.createElement("button");
      b.className="answer";
      b.textContent=ansObj.text;
      b.onclick=()=>{
        if(ansObj.index===q.c){score++;b.classList.add("correct");}
        else b.classList.add("incorrect");
        setTimeout(next,600);
      };
      rowDiv.appendChild(b);
    }
    aDiv.appendChild(rowDiv);
  }
}

function next(){
  qi++;
  if(qi<quizzes[currentQuizIndex].questions.length) showQ();
  else{
    hideAll();
    document.getElementById("score").classList.remove("hidden");
    document.getElementById("result").textContent=
      `Score : ${score} / ${quizzes[currentQuizIndex].questions.length}`;
  }
}

// PARTAGE iOS/Web
function shareQuiz(i){
  const quiz=quizzes[i];
  const data=JSON.stringify(quiz,null,2);
  const blob=new Blob([data],{type:"application/json"});
  const file=new File([blob],`${quiz.title||"quiz"}.json`,{type:"application/json"});

  if(navigator.canShare && navigator.canShare({files:[file]})){
    navigator.share({
      title: quiz.title,
      text: "Voici mon quiz !",
      files: [file]
    }).catch(err=>console.log(err));
  } else {
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download=`${quiz.title||"quiz"}.json`;
    a.click();
  }
}

function importQuiz(e){
  const r=new FileReader();
  r.onload=x=>{
    quizzes.push(JSON.parse(x.target.result));
    save();render();
  };
  r.readAsText(e.target.files[0]);
}

function exportAll(){
  const blob=new Blob([JSON.stringify(quizzes,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="quizzes.json";
  a.click();
}

home();
</script>
</body>
</html>

